\section{Геделева нумерация. Арифметизация доказательств}

Ранее мы показали, что любое рекурсивное арифметическое отношение 
выразимо в формальной арифметике. Теперь мы покажем, что наоборот,
любое выразимое в формальной арифметике отношение является рекурсивным.

\begin{definition} Ограниченные кванторы $\exists_{x<y} \phi(x)$ и
$\forall_{x<y} \phi(x)$ --- сокращения записи для выражений вида 
$\exists x (x < y \& \phi(x))$ и $\forall x (x \ge y \vee \phi (x))$
\end{definition}

\begin{theorem} Пусть $P_1$ и $P_2$ --- рекурсивные отношения.
Тогда следующие формулы, задающие некоторые отношения, также являются 
рекурсивными отношениями:

\begin{enumerate}
\item $F(x_1,\dots x_n,z) := \forall_{y<z} P_1(x_1,\dots x_n,y)$
\item $E(x_1, \dots x_n,z) := \exists_{y<z} P_1(x_1,\dots x_n,y)$
\item $P_1(x_1,\dots x_n) \rightarrow P_2(x_1,\dots x_n)$
\item $P_1(x_1,\dots x_n) \vee P_2(x_1,\dots x_n)$
\item $P_1(x_1,\dots x_n) \& P_2(x_1,\dots x_n)$
\item $\neg P_1(x_1, \dots x_n)$
\end{enumerate}
\end{theorem}

\begin{proof}Упражнение.
\end{proof}

Теперь мы перенесем понятие вывода формулы на язык рекурсивных отношений,
и, следовательно, внутрь языка формальной арифметики.

\begin{definition}{Геделева нумерация.}Дадим следующие номера символам языка
формальной арифметики:

\begin{tabular}{lll}
3 & (\\
5 & )\\
7 & ,\\
9 & $\neg$ \\
11 & $\rightarrow$ \\
13 & $\vee$ \\
15 & $\&$ \\
17 & $\forall$ \\
19 & $\exists$ \\
$13 + 8\cdot k$ & $x_k$ & переменные\\
$15 + 8\cdot k$ & $a_k$ & константы\\
$17 + 8\cdot 2^k \cdot 3^n$ & $f_k^n$ & n-местные функциональные символы: $(')$, $(+)$ и т.п.\\
$19 + 8\cdot 2^k \cdot 3^n$ & $P_k^n$ & n-местные предикаты, в т.ч. $(=)$
\end{tabular}
\end{definition}

Уточним язык --- обяжем всегда писать скобки всегда и только вокруг двуместной
операции. В принципе, иначе мы могли бы определить правильно операцию равенства Eq,
но это лишние технические сложности.

Научимся записывать выражения в виде чисел. Пусть $p_1, \dots p_k, \dots$ --- список простых
чисел, при этом $p_1 = 2, p_2 = 3, \dots$. 
%Также, пусть $Rm(a,b,c)$ --- это формула,
%представляющая отношение $c = a \% b$.

Тогда текст из $n$ символов с геделевыми номерами $c_1, \dots c_n$ запишем как число
$t = p_1^{c_1} \cdot p_2^{c_2} \cdot \dots \cdot p_n^{c_n}$. Ясно, что такое представление
однозначно позволяет установить длину строки (геделева нумерация не содержит 0, поэтому
можно определить длину строки как максимальный номер простого числа, на которое делится $t$;
будем записывать эту функцию как $Len(s)$),
и каждый символ строки в отдельности (будем записывать функцию как $(s)_n$).
Также ясно, что функции $Len$ и $(x)_n$ --- рекурсивны.

Чтобы удобнее работать со строками, введем следующую запись. Пусть есть запись
вида <<$с_1 c_2 c_3 \dots$>>, здесь $c_i$ --- какие-то символы языка формальной
арифметики, заключенные в кавычки. Эта запись задает число
$p_1^{c_1} \cdot \dots \cdot p_n^{c_n}$.

Операцию конкатенации строк $s \star t$ определим так. Пусть первая строка имеет символы
$s_1, \dots s_n$, а вторая --- $t_1, \dots t_m$. Тогда результат их конкатенации ---
$p_1^{s_1} \cdot \dots \cdot p_n^{s_n} \cdot p_{n+1}^{t_1} \cdot \dots \cdot p_{n+m}^{t_m}$.

Если в данной записи встретится символ с \$ перед ним: <<$\neg \$x \& y$>>, тогда
это означает вставку <<литерала>> (ср. язык Perl) --- интерпретировать это надо
как конкатенацию строки до литерала, самого литерала, и строки после литерала.
В данном примере --- <<$\neg$>>$ \star x \star $<<$\& y$>>.

Чтобы представить доказательства, мы будем объединять строки вместе так же, как
объединяем символы в строки: $2^{2^3} \cdot 3^{2^5}$ --- это последовательность
из двух строк, первая --- это <<(>>, а вторая --- <<)>>.

Теперь мы можем понять, как написать программу, проверяющую корректность доказательства 
некоторого утверждения в формальной арифметике. Наметим общую идею. Программа будет состоять из набора
рекурсивных отношений и функций, каждое из которых выражает некоторое 
отношение, содержательное для проверки доказательства. Ниже мы покажем идею 
данной конструкции, приведя несколько из них.

\begin{itemize}
\item Проверка того, что a - геделев номер выражения, являющегося переменной.
$Var(a) := \exists_{z < a} (a = 2 ^ {13 + z})$

\item Проверка того, что выражение с номером $a$ получено из выражений $b$ и $c$ 
путем применения правила Modus Ponens.
$MP (b,c,a) := c = $<<$( \$b \rightarrow \$a  )$>>

\item Проверка того, что $b$ получается из $a$ подстановкой $y$ вместо $x$:
$Subst (a,b,x,y)$ --- без реализации

\item Функция, подставляющая $y$ вместо $x$ в формуле $a$:\\
$Sub (a,x,y) := \mu \langle{}S\langle{}Subst,U^4_1,U^4_4,U^4_2,U^4_3\rangle\rangle(a,x,y)$

\item Проверка того, что переменная $x$ входит свободно в формулу $f$.\\
$Free (f,x) := \neg Subst(a,a,x,13 + 8^x)$

\item Функция, выдающая геделев номер выражения, соответствующего целому числу:
$Num (n) := R\langle{}$<<0>>$,$<<${\$U^3_3}'$>>$\rangle (n,n)$

\end{itemize}

Путем некоторых усилий мы можем выписать формулу, представляющую
двуместное отношение $Proof(f,p)$, истинное тогда и только тогда, когда
$p$ --- геделев номер доказательства формулы с геделевым номером $f$.

\begin{theorem}
Любая представимая в формальной арифметике функция является рекурсивной.
\end{theorem}
\begin{proof}
Возьмем некоторую представимую функцию $f: N^n \rightarrow N$. Значит, для нее существует
формула формальной арифметики, представляющая ее. Пусть $F$ --- эта формула
(со свободными переменными $x_1, \dots x_n, y$); при этом в случае 
$f(u_1, \dots u_n) = v$ должно быть доказуемо $F(\overline{u_1}, \dots \overline{u_n}, \overline{v})$.
По формуле можно построить рекурсивную функцию, $C_F (u_1, \dots u_n, v, p)$, 
выражающую тот факт, что $p$ --- геделев номер вывода формулы 
$F(\overline{u_1}, \dots \overline{u_n}, \overline{v})$. Тогда 
возьмем $$f (x_1, \dots x_n) := (\mu \langle{}S\langle{}C_F,U^{n+1}_1,\dots U^{n+1}_n,(U^{n+1}_{n+1})_1, (U^{n+1}_{n+1})_2)\rangle\rangle (x_1, \dots x_n))_1$$.
\end{proof}
