\section{Рекурсивные функции.}

Рассмотрим примитивы, из которых будем собирать выражения:

\begin{enumerate}
\item $Z: N \rightarrow N$, $Z(x) = 0$
\item $N: N \rightarrow N$, $N(x) = x'$
\item Проекция. $U^n_i: N^n \rightarrow N$, $U^n_i (x_1, ... x_n) = x_i$
\item Подстановка. Если $f: N^n \rightarrow N$ и $g_1, ... g_n: N^m \rightarrow N$, 
  то $S\langle{}f,g_1,...g_n\rangle: N^m \rightarrow N$.
При этом $S\langle{}f,g_1,...g_n\rangle (x_1,...x_m) = f(g_1(x_1,...x_m), ... g_n(x_1,...x_m))$
\item Примитивная рекурсия. Если $f: N^n \rightarrow N$ и $g: N^{n+2} \rightarrow N$, то
  $R\langle{}f,g\rangle: N^{n+1} \rightarrow N$, при этом
  $$R\langle{}f,g\rangle (x_1,...x_n,y) = \left\{\begin{array}{ll}
    f(x_1,...x_n) & , y = 0\\
    g(x_1,...x_n,y-1,R\langle{}f,g\rangle(x_1,...x_n,y-1)) &, y > 0
  \end{array}\right.$$
\item Минимизация. Если $f: N^{n+1} \rightarrow N$, то $\mu \langle{}f\rangle: N^n \rightarrow N$, при этом
  $\mu \langle{}f\rangle (x_1,...x_n)$ --- такое минимальное число $y$, что $f(x_1,...x_n,y) = 0$.
  Если такого $y$ нет, результат данного примитива неопределен.
\end{enumerate}

Если некоторая функция $N^n \rightarrow N$ может быть задана с помощью данных примитивов, 
то она называется рекурсивной. Если некоторую функцию можно собрать исключительно из первых 
5 примитивов (то есть без использования операции минимизации), то такая функция называется 
примитивно-рекурсивной. 

\begin{theorem}Следующие функции являются примитивно-рекурсивными:
сложение, умножение, ограниченное вычитание (которое равно 0, если результат вычитания отрицателен),
целочисленное деление, остаток от деления.
\end{theorem}

\begin{proof}Упражнение.\end{proof}

\section{Арифметические функции и отношения. Их выразимость в формальной арифметике.}

Введем обозначение. Будем говорить, что $\alpha (x_1, \dots x_n)$ --- это формула с $n$ свободными
переменными, если переменные $x_1, ... x_n$ входят в $\alpha$ свободно. Запись 
$\alpha (y_1, \dots y_n)$ будем трактовать, как $\alpha [x_1 := y_1, ... x_n := y_n]$, при этом
мы подразумеваем, что $y_1, \dots y_n$ свободны для подстановки вместо $x_1, \dots x_n$ в $\alpha$.

Также, запись $B(x_1, \dots x_n) := \alpha(x_1, \dots x_n)$ будет означать, что мы определяем
новую формулу с именем $B$. Данная формула должна восприниматься только как сокращение записи,
макроподстановка.

\begin{definition}
Арифметическая функция --- функция $f: N^n \rightarrow N$.
Арифметическое отношение --- $n$-арное отношение, заданное на $N$.
\end{definition}

\begin{definition}
Арифметическое отношение $R$ называется выразимым (в формальной арифметике), если 
существует такая формула $\alpha (x_1, \dots x_n)$ с $n$ свободными переменными, 
что для любых натуральных чисел $k_1$ ... $k_n$
\begin{enumerate}
\item если $R(k_1, \dots k_n)$ истинно, то доказуемо $\alpha (\overline{k_1}, \dots \overline{k_n})$
\item если $R(k_1, \dots k_n)$ ложно, то доказуемо $\neg \alpha (\overline{k_1}, \dots \overline{k_n})$.
\end{enumerate}
\end{definition}

Например, отношение $(<)$ является выразимым в арифметике:
Рассмотрим формулу $\alpha (a_1, a_2) = \exists b (\neg b = 0 \& a_1 + b = a_2)$.
В самом деле, если взять некоторые числа $k_1$ и $k_2$, такие, что $k_1 < k_2$, то найдется
такое положительное число $b$, что $k_1 + b = k_2$. Можно показать, что если подставить
$\overline{k_1}$ и $\overline{k_2}$ в $\alpha$, то формула будет доказуема. 

Наметим доказательство:
Тут должно быть два доказательства по индукции, сперва по $k_2$, потом по $k_1$.
Рассмотрим доказательство по индукции: пусть $k_1 = 0$, индукция по 2-му параметру:
Разберем доказательство базы при $k_2 = 1$. Тогда надо показать $\exists b (\neg b = 0 \& 0 + b = 1)$:

\begin{tabular}{lll}
(1) & $\neg 1 = 0 \& 0 + 1 = 1$ & Несложно показать\\
(2) & $(\neg 1 = 0 \& 0 + 1 = 1) \rightarrow \exists b (\neg b = 0 \& 0 + b = 1)$ & Cх. акс. для $\exists$\\
(3) & $\exists b (\neg b = 0 \& 0 + b = 1)$ & M.P. 1 и 2.
\end{tabular}

\begin{definition} Введем следующее сокращение записи:
пусть $\exists ! y \phi (y)$ означает $$\exists y \phi (y) \& \forall a \forall b (\phi(a) \& \phi(b) \rightarrow a=b)$$
Здесь $a$ и $b$ --- некоторые переменные, не входящие в формулу $\phi$ свободно.
\end{definition}

\begin{definition} Арифметическая функция $f$ от $n$ аргументов называется представимой в 
формальной арифметике, если существует такая формула $\alpha (x_1, \dots x_{n+1})$ с $n+1$ 
свободными пременными, что для любых натуральных чисел $k_1$ ... $k_n$
\begin{enumerate}
\item $f(k_1, \dots k_n) = k_{n+1}$ тогда и только тогда, когда доказуемо 
$\alpha (\overline{k_1}, \dots \overline{k_{n+1}})$.
\item Доказуемо $\exists ! b (\alpha (\overline{k_1}, \dots \overline{k_n}, b)$
\end{enumerate}

%Функция называется сильно представимой, если в свойстве 2 натуральные числа заменить на переменные:
%$\exists ! b (\alpha (a_1, \dots a_n, b)$
\end{definition} 

%Очевидно, что сильно представимая функция также является представимой --- с помощью уже 
%встречавшегося ранее трюка с введением квантора всеобщности, а потом с подстановкой 
%конкретного терма вместо переменной мы можем подставить любые константы вместо переменных.

\begin{theorem} Функции $Z$, $N$, $U^n_i$ являются представимыми. \end{theorem}
\begin{proof}
Наметим доказательство. Для этого приведем формулы, доказательство корректности этих 
формул оставим в виде упражнения.
\begin{itemize}
\item Примитив $Z$ представит формула $Z (a, b) := (a=a \& b=0)$.
\item Примитив $N$ представит формула $N (a, b) := (a' = b)$.
\item Примитив $U^n_i$ представит формула $U^n_i (a_1, ...a_n, b) = (a_1=a_1) \& ... \& (a_n=a_n) \& (b= a_i)$.
\end{itemize}
\end{proof}

\begin{theorem} Если функции $f$ и $g_1$, ... $g_m$ представимы, 
то функция $S\langle{}f,g_1,\dots g_m\rangle$ также представима. \end{theorem}
\begin{proof}Поскольку функции $f$ и $g_i$ представимы, то есть формулы $F$ и $G_1, \dots G_m$,
их представляющие. Тогда следующая формула представит $S\langle{}f,g_1,\dots g_m\rangle$: 
$$S (a_1, \dots a_n, b) := \exists b_1 \dots \exists b_m 
  (G_1 (a_1, \dots a_n, b_1) \& \dots \& G_m (a_1, \dots a_n, b_m) \& F (b_1, \dots b_m, b))$$
\end{proof}

\begin{definition}
Характеристическая функция арифметического отношения $R$ --- это функция
 $$C_R (x_1, ... x_n) = \left\{\begin{array}{ll}0 &R (x_1,...x_n)\\1 & R (x_1,...x_n) \textrm{ неверно}\end{array}\right.$$
\end{definition}

Очевидно, что характеристическая функция представима тогда и только тогда, когда отношение выразимо.

\begin{definition}
$\beta$-функция Геделя - это функция $\beta (b,c,i) = b \% (1 + c \cdot (i + 1))$. Здесь операция (\%) означает
взятие остатка от целочисленного деления.
\end{definition}

\begin{lemma}Функция примитивно-рекурсивна, и при этом представима в арифметике 
формулой $B (b,c,i,d) := \exists q ((b = q \cdot (1 + c \cdot (i+1)) + d) \& (d < 1 + c \cdot (i+1)))$
\end{lemma}
\begin{proof}Упражнение.\end{proof}

\begin{lemma} 
Для любой конечной последовательности чисел $k_0$ ... $k_n$ можно подобрать
такие константы $b$ и $c$, что $\beta (b,c,i) = k_i$ для $0 \le i \le n$.
\end{lemma}

\begin{proof}
Возьмем число $c = max(k_1,\dots k_n,n)!$. Рассмотрим числа $u_i = 1 + c \cdot (i+1)$. 

\begin{itemize}

\item Никакие числа $u_i$ и $u_j$ $(0 \le j < i \le n)$ не имеют общих делителей кроме 1.
Пусть это не так, и есть некоторый общий делитель $p$ (очевидно, мы можем предположить его
простоту --- разложив на множители, если он составной).
Тогда $p$ будет делить $u_i - u_j = c \cdot (i - j)$,
при этом $p$ не может делить $c$ --- иначе окажется, что $u_i = (1 + c \cdot (i+1))$ делится на $p$
и $c \cdot (i+1)$ делится на $p$. Значит, $p$ делит $i-j$, то есть все равно делит $c$, так как
$c$ --- факториал некоторого числа, не меньшего $n$, и при этом $i-j \le n$.

\item Каждое из чисел $k_i$ меньше, чем $u_i$: в самом деле, $k_i \le c < 1 + c \cdot (i+1) = u_i$.

\item Согласно китайской теореме об остатках, если некоторые натуральные числа $k_0, \dots k_n$
попарно взаимно просты, то для любых целых чисел $u_0, \dots u_n$, таких, что $0 \le k_i < u_i$,
найдется такое целое число $b$, для которого выполнено $k_i = b \% u_i$. Возьмем $b$, подсказываемое
теоремой об остатках.
\end{itemize}
\end{proof}

\begin{theorem}Всякая рекурсивная функция представима в арифметике.\end{theorem}
\begin{proof}
Представимость первых четырех примитивов уже показана. Покажем представимость примитивной рекурсии и 
операции минимизации.

\emph{Примитивная рекурсия.} Пусть есть некоторый $R \langle{} f,g \rangle$. Соответственно, $f$ и $g$ уже 
представлены как некоторые формулы $F$ и $G$. Из определения $R\langle{}f,g\rangle$ мы знаем,
что для значения $R \langle{} f,g \rangle (x_1,...x_{n+1})$ должна существовать последовательность
$a_0 ... a_{x_{n+1}}$ результатов применения функций f и g --- значений на одно больше, чем 
итераций в цикле примитивной рекурсии,
а это количество определяется последним параметром функции $R \langle{}f,g\rangle$. При этом:

\begin{tabular}{l}
$a_0 = f(x_1, \dots x_n)$\\
$a_1 = g(x_1, \dots x_n,0,a_0)$\\
...\\
$a_{x_{n+1}} = g(x_1, \dots x_n, x_{n+1}-1,a_{x_{n+1}-1})$
\end{tabular}

Значит, по лемме, должны существовать такие числа $b$ и $c$, что
$\beta (b,c,i) = a_i$ для $0 \le i \le x_{n+1}$.

Приведенные рассуждения позволяют построить следующую формулу, представляющую $R\langle{}f,g\rangle (x_1, ... x_{n+1})$:

\begin{center}
$R(x_1, \dots x_{n+1}, a) := \exists b \exists c (\exists k (B (b,c,0,k) \& F (x_1,...x_n, k))$\\
       $\;\;\;\& B (b,c,x_{n+1},a)$\\
       $\;\;\;\& \forall k (k < x_{n+1} \rightarrow \exists d \exists e (B (b,c,k,d) \& B (b,c,k',e) \&
           G (x_1,..x_n,k,d,e)))$
\end{center}

\emph{Минимизация.} Рассмотрим конструкцию $\mu\langle{}f\rangle$. $f$ уже представлено 
как некоторая формула $F$. Тогда формула 
$M (x_1, \dots x_n,y) := F(x_1, \dots x_n,y,0) \& \forall z (z < y \rightarrow \neg F (x_1, \dots x_n,z,0))$
представит $\mu\langle{}f\rangle$.

\end{proof}
