\section{Исчисление предикатов}

Выберем множество истинностных значений $V$.
Также, выберем некоторое предметное множество $D$.
\emph{n-местным предикатом} мы назовем функцию из $D^n$ в $V$.
Как и раньше, мы ограничимся классическим множеством $V$ -- истина и ложь,
но оставляем потенциальную возможность его расширить.

Предикаты могут быть 0-местными, в этом случае это хорошо нам известные
пропозициональные переменные, принимающие какие-то истинностные значения, 
в происхождение которых мы не вникаем. 

Рассмотрим следующий известный пример: каждый человек смертен, Сократ - человек,
следовательно, Сократ - смертен. 
Мы можем формализовать это выражение с помощью предикатов: множество $D$ - это
будет множество всех существ, $S(x)$ - предикат <<быть смертным>>,
$H(x)$ - предикат <<быть человеком>>. Тогда фраза в полу-формальном виде
выглядит так:
Для каждого $x$, такого, что $H(x)$ верно $S(x)$, поэтому поскольку H(Сократ),
значит, что имеет место S(Сократ).

Определим язык исчисления предикатов более точно. В исчислении предикатов 
появляется два типа значений:
логические (которые участвуют в связках) и предметные (со значениями из множества $D$).
Соответственно, все выражения также делятся на два типа. 

Логические выражения --- это логические связки плюс
предикаты --- обобщение пропоизициональных переменных, которые теперь могут
иметь параметрами предметные выражения.

Предметные выражения --- это либо \emph{предметные переменные} (обозначаются 
маленькими латинскими буквами, также возможно с индексами), либо \emph{функции},
которые действуют из $D^n$ в $D$.

Например, в выражении $1+5=0$, понимаемом в смысле исчисления предикатов, есть 
три константы (то есть, три нуль-местных функции --- это 0,1 и 5), одна
двухместная функция (плюс), и один предикат (равенство).

Формула исчисления предикатов --- это всегда логическое выражение. Например, $5+1$ 
в смысле предыдущего примера не может являться формулой исчисления предикатов.

Помимо этого, мы добавим две новых логических связки:
\begin{itemize}
\item Квантор всеобщности: $\forall x \alpha$ (здесь и в следующем определении
$x$ --- некоторая предметная переменная, а $\alpha$ --- некоторая формула исчисления 
предикатов).
\item Квантор существования: $\exists x \alpha$.
\end{itemize}

Кванторы ведут себя как унарные операции и действуют только на ближайшее за
ними выражение логического типа. Например, формула $\forall x x = 5 \vee x = 7$
соответствует формуле $(\forall x (x=5)) \vee (x=7)$.

Мы надеемся, что в целом смысл этих конструкций интуитивно понятен, теперь
мы перейдем к более формальному описанию.

\subsection{Доказательства в исчислении предикатов}
\begin{definition}Дана некоторая формула $s$.
Будем говорить, что подстрока $s_1$ строки $s$ является подформулой, 
если она в точности соответствует какому-то одному нетерминалу
в дереве разбора строки $s$.\end{definition}

\begin{definition}Если в формулу входит подформула, полученная по правилам
для кванторов (то есть, $\forall x \alpha$ или $\exists x \alpha$), то 
мы будем говорить, что формула $\alpha$ находится в области действия 
данного квантора по переменной $x$. Также, будем говорить, что любая подформула 
формулы $\alpha$ находится в области действия данного квантора.
\end{definition}

\begin{definition}Если некоторое вхождение переменной $x$ находится
в области действия квантора по переменной $x$, то такое вхождение
мы назовем \emph{связанным}. Вхождение переменной $x$ непосредственно рядом 
с квантором ($\forall x \dots$) мы назовем \emph{связывающим}.
Те вхождения переменных, которые не являются связанными 
или связывающими, назовем \emph{свободными}. Формула, не имеющая 
свободных вхождений переменных, называется \emph{замкнутой}.
\end{definition}

\begin{definition}Будем говорить, что переменная $y$ свободна для $x$ 
при подстановке в формулу $\psi$ (или просто свободна для подстановки 
вместо $x$), если после подстановки $y$ вместо свободных вхождений $x$
ни одно ее вхождение не станет связанным.
\end{definition}

Чтобы получить список аксиом для исчисления предикатов, возьмем все схемы
аксиом исчисления высказываний и дополним их следующими двумя схемами.
Здесь $x$ - переменная, $\psi$ - некоторая формула, $y$ - некоторая переменная.
Запись $\psi[x := y]$ будет означать результат подстановки $y$ в $\psi$ вместо 
всех свободных вхождений $x$. Пусть $y$ свободно для подстановки вместо $x$.

\begin{tabular}{lll}
(11) & $\forall{x}(\psi) \rightarrow (\psi[x := \alpha])$\\ 
(12) & $(\psi[x := \alpha]) \rightarrow \exists{x}(\psi)$
\end{tabular}

Заметим, что если взять формулу $\exists x A(x,y)$, то по схеме аксиом (11),
если игнорировать ограничение на свободу для подстановки, 
следующее утверждение должно быть тавталогией: 
$\forall y \exists x A(x,y) \rightarrow \exists x A (x,x)$. Однако, оно ей не является.

Все аксиомы, порожденные данными схемами в новом языке, мы назовем аксиомами исчисления
предикатов.

Правила вывода.
Пусть $x$ не входит свободно в $\phi$. Тогда рассмотрим следующие дополнительные
правила вывода исчисления предикатов:

\begin{tabular}{lll}
$\infer{(\phi) \rightarrow \forall{x}(\psi)}{(\phi) \rightarrow (\psi)}$ &
$\infer{\exists{x}(\psi) \rightarrow (\phi)}{(\psi) \rightarrow (\phi)}$
\end{tabular}

Добавив эти схемы к схеме для правила Modus ponens исчисления высказываний,
мы сможем породить множество правил вывода.

%<<Не входит свободно>> - это также важный вопрос.
%Рассмотрим формулу $A(x) \rightarrow A(x)$. Легко показать, что такая
%формула общезначима и доказуема. Однако, $(\exists{x}A(x)) \rightarrow A(x)$
%не является общезначимой, если $A(x)$ не общезначима: достаточно взять в качестве 
%оценки свободной переменной $x$ то значение, на котором $A(x)$ ложна.
%Вывод из гипотез также вполне можно расширить на исчисление предикатов.

\subsection{Оценка выражений в исчислении предикатов}

Для задания оценки для выражения в исчислении предикатов необходимо
вместо оценки для переменных $f_P$ в исчислении высказываний ввести
оценку для предикатов: для каждого $k$-местного предиката $P^k_n$ определить
функцию $f_{P^k_n}: D^k \rightarrow V$.

\begin{definition}Формула в исчислении предикатов общезначима, если она 
истинна на любом предметном множестве $D$, 
при любой оценке предикатов, и при любых оценках свободных индивидных 
переменных.
\end{definition}

\begin{definition}Пусть имеется некоторое исчисление предикатов с множеством
аксиом $A$, и пусть дан некоторый (возможно, пустой) список $\Gamma$ 
формул исчисления предикатов. Тогда, вывод формулы $\alpha$
в исчислении с аксиомами $A \cup \Gamma$ мы назовем выводом из 
допущений $\Gamma$, и будем записывать это как $\Gamma \vdash \alpha$.
\end{definition}

Формулы в списке формул не обязаны быть замкнутыми: например, легко 
показать, что $P(x,y), P(x,y)\rightarrow P(y,x) \vdash P(y,x)$. Однако,
со свободными переменными в допущениях надо быть осторожными, что 
находит своё отражение в теореме о дедукции для исчисления предикатов.

\begin{theorem}
Теорема о дедукции. Если $\Gamma, \alpha \vdash \beta$, 
и в доказательстве отстутствуют применения правил для кванторов, использующих
свободные переменные из формулы $\alpha$, то $\Gamma \vdash \alpha \rightarrow \beta$
\end{theorem}

\begin{proof}
Доказательство разбором случаев. 3 старых случая те же, добавилось 
2 новых правила вывода. Упражнение.
\end{proof}

\begin{lemma}\label{free_substitution}
$\llbracket \psi \rrbracket^{x := \llbracket\theta\rrbracket} = \llbracket \psi[x := \theta] \rrbracket$,
если $\theta$ свободна для подстановки в $\psi$ вместо $x$.
\end{lemma}

\begin{proof}
Воспользуемся структурной индукцией по выражению $\psi$.

База индукции. Пусть $\psi$ --- это предикат. Тогда из способа вычисления значения предикатов 
очевидно, что
$\llbracket P(\theta,y_1,\dots y_n) \rrbracket = \llbracket P(x,y_1,\dots y_n)\rrbracket^{x := \llbracket \theta \rrbracket}$.

Переход индукции. Пусть $\psi$ составлено из одного или двух выражений, про которые
утверждение уже доказано. Рассмотрим варианты:

\begin{itemize}
\item $\psi \equiv \alpha \rightarrow \beta$, $\psi \equiv \alpha \& \beta$, $\psi \equiv \alpha \vee \beta$ или
$\psi \equiv \neg \alpha$. Рассмотрение всех этих случаев схоже, возьмем для примера конъюнкцию.

%\begin{tabular}{ll}
$\llbracket\alpha\&\beta\rrbracket^{x:=\llbracket\theta\rrbracket}
=\llbracket\alpha\rrbracket^{x:=\llbracket\theta\rrbracket}\&\llbracket\beta\rrbracket^{x:=\llbracket\theta\rrbracket}
=\llbracket\alpha[x := \theta]\rrbracket\&\llbracket\beta[x:=\theta]\rrbracket
=\llbracket\alpha[x := \theta]\&\beta[x := \theta]\rrbracket = \llbracket(\alpha\&\beta)[x := \theta]\rrbracket$
%\end{tabular}

\item $\psi \equiv \forall y \alpha$ или $\psi \equiv \exists y \alpha$. Опять же, рассмотрение случаев
аналогично. Покажем, что 
$\llbracket \forall y \alpha \rrbracket^{x := \llbracket\theta\rrbracket} = \llbracket (\forall y \alpha)[x:=\theta] \rrbracket$.

Без уменьшения общности можем предположить, что $x$ входит свободно в $\forall y\alpha$ --- иначе данная замена
не оказывает влияние на вычисление результата, и равенство очевидно.

Поскольку $\theta$ свободна для подстановки вместо $x$ в $\psi$, то, значит, 
$y$ не входит свободно в $\theta$ (иначе свободный $y$ стал бы связанным при подстановке,
а подстановки обязательно будут иметь место, раз $x$ входит свободно в $\forall y\alpha$).

%Вычислим $\llbracket\theta\rrbracket=v_\theta$ в некоторой фиксированной оценке.
%Если $\llbracket\forall y \alpha\rrbracket^{x := v_\theta} = \texttt{И}$, то не найдётся 
%такого $v_y$, что $\llbracket\alpha\rrbracket^{x := v_\theta, y := v_y} = \texttt{Л}$. 

По предположению индукции, $\llbracket\alpha\rrbracket^{x := \llbracket\theta\rrbracket} = 
\llbracket\alpha[x:=\theta]\rrbracket$. И, более того,
$\llbracket\alpha\rrbracket^{x := \llbracket\theta\rrbracket, y := v_y} = \llbracket\alpha[x:=\theta]\rrbracket^{y := v_y}$,
поскольку вычисление оценки $\theta$ не зависит от значения переменной $y$.
Значит, оценки полных формул с квантором также будут совпадать.
\end{itemize}

\end{proof}

\begin{theorem}
Исчисление предикатов корректно, т.е. любое доказуемое утверждение общезначимо.
\end{theorem}

\begin{proof}
Рассмотрим некоторое доказательство $\gamma_1, \dots \gamma_n$, и покажем, что
каждое из утверждений в доказательстве является общезначимым. Этим мы покажем 
утверждение теоремы.

Рассмотрим какое-то утверждение $\gamma_i$. Оно либо является частным случаем
какой-либо из схем аксиом, либо получено из предыдущих утверждений доказательства.
путем применения правил вывода.

Мы ограничимся рассмотрением только новых (по сравнению с исчислением высказываний)
схем аксиом и правил, поскольку только в них доказательство будет отличаться
от аналогичного для исчисления высказываний.

Возможны следующие варианты:
\begin{enumerate}
\item $\gamma_i \equiv \forall{x}(\psi) \rightarrow (\psi[x := \theta])$ при 
некоторых $x$ (имя переменной тоже может быть разным), $\psi$ и $\theta$. 
Значит, нам необходимо показать, что при любых $x$, $\psi$ и $\theta$ 
(естественно, таких, что $\theta$ свободна для подстановки вместо $x$ в $\psi$) 
данное выражение будет истинным в любой оценке.

Фиксируем некоторую оценку и докажем утверждение от противного. 
Пусть это не так, и 
$\llbracket \forall{x}(\psi)\rightarrow(\psi[x := \theta])\rrbracket = \texttt{Л}$.
Тогда неизбежно, что $\llbracket \forall{x}(\psi) \rrbracket = \texttt{И}$, но
$\llbracket \psi[x:=\theta] \rrbracket = \texttt{Л}$ (поскольку при остальных значениях
подвыражений импликация будет истинна). 

Пусть в данной оценке $\llbracket\theta\rrbracket=v_\theta$. 
По лемме \ref{free_substitution} верно, что 
$\llbracket \psi[x:=\theta] \rrbracket = \llbracket\psi\rrbracket^{x:=v_\theta}$,
причём, поскольку $\llbracket \psi[x:=\theta] \rrbracket = \texttt{Л}$, то
$\llbracket\psi\rrbracket^{x:=v_\theta} = \texttt{Л}$.
Но тогда $\llbracket \forall{x}(\psi) \rrbracket = \texttt{И}$ означает, что 
при любом $v_x \in D$ будет выполнено $\llbracket \psi \rrbracket^{x := v_x} = \texttt{И}$. 
Противоречие.

\item $\gamma_i \equiv (\psi[x := \theta]) \rightarrow \exists{x}(\psi)$ при некоторых
$x$, $\psi$ и $\theta$. Рассмотрение аналогично предыдущему пункту: заметим, что импликация
опровергается только если $\llbracket \exists{x}(\psi) \rrbracket = \texttt{Л}$, но
$\llbracket \psi[x:=\theta] \rrbracket = \texttt{И}$. По лемме 
\ref{free_substitution} при вычислении оценки формулы мы можем отдельно вычислить
$v_\theta = \llbracket\theta\rrbracket$, и показать, что 
$\llbracket \psi[x:=\theta] \rrbracket = \llbracket\psi\rrbracket^{x:=v_\theta}$, что 
гарантирует существование элемента в $D$, на котором формула $\psi$ истинна.

\item $\gamma_i \equiv \phi \rightarrow \forall{x}\psi$ и существует такой $j < i$, что
$\gamma_j \equiv \phi \rightarrow \psi$, при этом $x$ не входит свободно в $\phi$.

Опять же, фиксируем некоторую оценку.
Нам нужно показать, что $\forall{x}\psi$ не бывает ложным, если $\phi$ истинно.

По предположению индукции мы знаем, что $\llbracket \phi \rightarrow \psi \rrbracket = \texttt{И}$.
Пусть $\llbracket\forall{x}\psi\rrbracket = \texttt{Л}$. То есть, найдётся такой $v_x$ из $D$, что
$\llbracket\forall{x}\psi\rrbracket^{x:=v_x} = \texttt{Л}$. 
Но заметим, что $x$ не входит свободно в $\phi$. Значит, $\llbracket \phi \rrbracket^{x:=v_x} = \texttt{И}$.
Значит, $\llbracket\phi \rightarrow \psi\rrbracket^{x:=v_x} = \texttt{Л}$. Противоречие с общезначимостью $\gamma_j$.

\item Правило для квантора существования доказывается аналогично.

\end{enumerate}

\end{proof}
